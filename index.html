<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdmartHelper Pro - Визуальный расчет букв</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --main-bg-color: #2c2c2c;
            --text-color: #e0e0e0;
            --primary-color: #e74c3c;
            --primary-hover-color: #c0392b;
            --border-color: #444;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --input-bg-color: #333;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
        }
        .header {
            background-color: var(--main-bg-color);
            padding: 15px 30px;
            box-shadow: 0 4px 12px var(--shadow-color);
            border-bottom: 3px solid var(--primary-color);
        }
        .header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        #header-logo {
            height: 40px;
            width: auto;
        }
        .main-nav { display: flex; justify-content: flex-start; gap: 30px; }
        .main-nav a { color: #ccc; text-decoration: none; font-weight: 500; transition: color 0.3s; }
        .main-nav a:hover { color: var(--primary-color); }
        .language-switcher button {
            background: none; border: 1px solid var(--border-color); color: var(--text-color);
            padding: 5px 10px; margin-left: 5px; cursor: pointer; border-radius: 5px; transition: 0.3s;
        }
        .language-switcher button.active { background-color: var(--primary-color); border-color: var(--primary-color); color: #fff; }
        .main-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 30px; 
            max-width: 1600px; 
            margin: 30px auto; 
            padding: 0 20px; 
        }
        .calc-panel, .results-panel { 
            background-color: var(--main-bg-color); 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 8px 25px var(--shadow-color);
            display: flex;
            flex-direction: column;
        }
        .results-panel { grid-column: 1 / -1; }
        h2 { margin-top: 0; color: #fff; font-size: 22px; }
        h3 { margin-top: 0; color: #fff; font-size: 20px;}
        label { display: block; margin-top: 15px; font-weight: 500; font-size: 14px; }
        select, input {
            width: 100%; padding: 12px; margin-top: 8px; border: 1px solid var(--border-color);
            background-color: var(--input-bg-color); color: var(--text-color);
            border-radius: 8px; font-size: 16px; box-sizing: border-box;
        }
        .button-group { display: flex; gap: 10px; margin-top: auto; padding-top: 20px;}
        .calculate-btn {
            flex-grow: 1; padding: 15px; background: var(--primary-color); color: #fff;
            border: none; cursor: pointer; transition: 0.3s; border-radius: 8px; font-size: 18px; font-weight: 700;
        }
        .calculate-btn:hover { background: var(--primary-hover-color); }
        .reset-btn {
            padding: 15px; background: #555; color: #fff; border: none; cursor: pointer;
            transition: 0.3s; border-radius: 8px; font-size: 18px;
        }
        .reset-btn:hover { background: #666; }
        .tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; flex-wrap: wrap;}
        .tab-button {
            padding: 12px 15px; border: none; background: none; cursor: pointer;
            font-size: 16px; font-weight: 500; color: #aaa;
            border-bottom: 3px solid transparent; margin-bottom: -1px; transition: 0.3s; flex-grow: 1; text-align: center;
        }
        .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .result-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .result-item { background-color: #333; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary-color); }
        .result-item .label { font-weight: 500; font-size: 14px; opacity: 0.8; }
        .result-item .value { font-size: 20px; font-weight: 700; }
        .calc-panel .result { white-space: pre-wrap; margin-top: 20px; padding: 15px; background-color: #333; border-radius: 8px; border-left: 4px solid var(--primary-color); line-height: 1.8; }
        .calc-panel .result strong { color: var(--primary-color); font-size: 1.1em;}
        .summary-list { list-style: none; padding: 0; }
        .summary-list li { background-color: #333; margin-bottom: 10px; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 5px;}
        .summary-list .label { font-weight: 500; }
        .summary-list .value { font-size: 18px; font-weight: 700; color: var(--primary-color); text-align: right; flex-grow: 1;}
        #visual-schemes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .scheme-item { text-align: center; }
        .scheme-item canvas {
            border: 1px solid var(--border-color);
            display: block;
            margin: 0 auto 5px auto;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            background-color: var(--input-bg-color);
        }
        .loader { text-align: center; padding: 40px; font-size: 18px; display: none; }
        .radio-group { display: flex; gap: 20px; margin-top: 15px; }
        .radio-group label { display: flex; align-items: center; gap: 8px; margin-top: 0; cursor: pointer; }

        /* --- АДАПТИВНОСТЬ --- */
        @media (max-width: 800px) {
            body { font-size: 15px; }
            .main-container { 
                gap: 20px;
                padding: 0 15px;
                margin: 20px auto;
            }
            .calc-panel, .results-panel { 
                padding: 20px;
            }
            .header { padding: 15px; }
            .main-nav { flex-wrap: wrap; gap: 10px 20px; justify-content: center; }
            .header-top { flex-direction: column; gap: 15px; }
        }
        @media (max-width: 480px) {
            .header-top { flex-direction: row; align-items: center; }
            #header-logo { height: 30px; }
            .language-switcher { margin-left: auto; }
            h2 { font-size: 20px; }
            h3 { font-size: 18px; }
            .button-group { flex-direction: column; }
            .calculate-btn, .reset-btn { font-size: 16px; }
            .tab-button { padding: 10px 8px; font-size: 14px;}
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-top">
            <img src="unnamed.png" alt="AdmartHelper Logo" id="header-logo">
            <div class="language-switcher">
                <button id="lang-ru" data-lang="ru">Русский</button>
                <button id="lang-en" data-lang="en">English</button>
            </div>
        </div>
        <nav class="main-nav">
            <a href="https://admart.kz/g1157172-istochniki-sveta-led" target="_blank" data-translate-key="nav_lights">Источники света LED</a>
            <a href="https://admart.kz/g325277-listovye-materialy" target="_blank" data-translate-key="nav_materials">Листовые материалы</a>
            <a href="https://admart.kz/g325279-istochniki-upravleniya-kontrollery" target="_blank" data-translate-key="nav_controllers">Источники управления</a>
        </nav>
    </header>

    <div class="main-container">
        <div class="calc-panel" id="sign-calc-panel">
            <h2 data-translate-key="project_params_title">Параметры вывески</h2>
            <label for="project-text" data-translate-key="sign_text_label">Текст вывески:</label>
            <input type="text" id="project-text" placeholder="ADMART">
            <label for="project-height" data-translate-key="letter_height_label">Высота букв (мм):</label>
            <input type="number" id="project-height" value="300">
            <label for="project-length" data-translate-key="sign_length_label">Длина вывески (мм):</label>
            <input type="number" id="project-length" value="1500">
            <label for="project-depth" data-translate-key="letter_depth_label">Глубина букв (мм):</label>
            <input type="number" id="project-depth" value="80">
            <label for="diode-series" data-translate-key="diode_series_label">Серия светодиодов:</label>
            <select id="diode-series"></select>
            <label for="light-source" data-translate-key="diode_modules_label">Светодиодные модули:</label>
            <select id="light-source"></select>
            <div class="button-group">
                <button id="calculate-btn" class="calculate-btn" data-translate-key="calculate_btn">Рассчитать</button>
                <button id="reset-btn" class="reset-btn" data-translate-key="reset_btn">Сброс</button>
            </div>
        </div>
        
        <div class="calc-panel" id="power-calc-panel">
            <h2 data-translate-key="power_calc_title">Быстрый расчет БП</h2>
            <label for="psu-voltage" data-translate-key="voltage_label">Напряжение:</label>
            <select id="psu-voltage">
                <option value="12">12V</option>
                <option value="24">24V</option>
            </select>
            <label for="psu-product-type" data-translate-key="product_type_label">Тип продукции:</label>
            <select id="psu-product-type">
                <option value="module" data-translate-key="product_module">Диодные модули</option>
                <option value="strip" data-translate-key="product_strip">Светодиодная лента</option>
            </select>
            <label for="psu-wattage-per-unit" id="psu-wattage-label" data-translate-key="wattage_per_item_label_module">Мощность на модуль (Вт):</label>
            <input type="number" id="psu-wattage-per-unit" placeholder="1.2">
            <label for="psu-quantity" id="psu-quantity-label" data-translate-key="quantity_label_module">Количество модулей (шт):</label>
            <input type="number" id="psu-quantity" placeholder="100">
            <label for="psu-safety-margin" data-translate-key="safety_margin_label">Запас мощности:</label>
            <select id="psu-safety-margin">
                <option value="0.15">15%</option> <option value="0.20">20%</option> <option value="0.25">25%</option> <option value="0.30" selected>30%</option>
            </select>
            <div id="power-calc-result" class="result" style="display:none;"></div>
            <div class="button-group">
                 <button id="calculate-psu-btn" class="calculate-btn" data-translate-key="calculate_btn_power">Расчет БП</button>
                 <button id="reset-psu-btn" class="reset-btn" data-translate-key="reset_btn">Сброс</button>
            </div>
        </div>
        
        <div class="calc-panel" id="sheet-calc-panel">
            <h2 data-translate-key="sheet_calc_title">Расчет листовых материалов</h2>
            
            <label data-translate-key="material_type_label">Тип материала:</label>
            <select id="sheet-material-type"></select>
            
            <div id="sheet-series-group" style="display:none;">
                <label data-translate-key="pvc_series_label">Серия:</label>
                <select id="sheet-series"></select>
            </div>

            <label data-translate-key="pvc_thickness_label">Толщина:</label>
            <select id="sheet-thickness"></select>
            
            <label data-translate-key="calc_method_label">Метод расчета:</label>
            <div class="radio-group">
                <label><input type="radio" name="sheet-calc-method" value="dims" checked> <span data-translate-key="calc_method_dims">По размерам</span></label>
                <label><input type="radio" name="sheet-calc-method" value="sqm"> <span data-translate-key="calc_method_sqm">По площади</span></label>
            </div>

            <div id="sheet-dims-inputs">
                <label data-translate-key="width_label">Ширина (мм):</label>
                <input type="number" id="sheet-width" placeholder="1000">
                <label data-translate-key="height_label">Высота (мм):</label>
                <input type="number" id="sheet-height" placeholder="1000">
            </div>
            <div id="sheet-sqm-input" style="display:none;">
                <label data-translate-key="sqm_label">Площадь (м²):</label>
                <input type="number" id="sheet-sqm" placeholder="1.5">
            </div>
            <div id="sheet-calc-result" class="result" style="display:none;"></div>
            <div class="button-group">
                <button id="calculate-sheet-btn" class="calculate-btn" data-translate-key="calculate_btn_sheet">Рассчитать листы</button>
                <button id="reset-sheet-btn" class="reset-btn" data-translate-key="reset_btn">Сброс</button>
            </div>
        </div>

        <div class="results-panel" id="results-panel" style="display:none;">
            <div class="tabs">
                <button class="tab-button active" data-tab="summary" data-translate-key="summary_tab">Сводка</button>
                <button class="tab-button" data-tab="lighting" data-translate-key="lighting_tab">Схемы букв</button>
                <button class="tab-button" data-tab="power" data-translate-key="power_tab">Питание</button>
            </div>
            <div id="summary" class="tab-content active">
                <h3 data-translate-key="summary_title">Итоговая сводка по проекту</h3>
                <ul id="summary-list" class="summary-list"></ul>
            </div>
            <div id="lighting" class="tab-content">
                <h3 data-translate-key="lighting_title_new">Визуальные схемы расположения диодов</h3>
                <div class="loader" id="visual-loader">Идет отрисовка и расчет...</div>
                <div id="visual-schemes"></div>
            </div>
            <div id="power" class="tab-content">
                 <h3 data-translate-key="power_title">Расчет блока питания</h3>
                 <div id="power-result" class="result-grid"></div>
            </div>
        </div>
    </div>

<script>
class AdmartVisualHelper {
    constructor() {
        this.DIODE_DATA = { "ECO": { name: "ECO серия", modules: { 'eco_0.72': { name: 'Трехточечный 0.72W ECO', power: 0.72 }, 'eco_1.2': { name: 'Трехточечный 1.2W ECO', power: 1.2 } } }, "MINI": { name: "MINI серия", modules: { 'mini_0.72': { name: 'Трехточечный 0.72W MINI', power: 0.72 } } }, "COMPACT": { name: "COMPACT серия", modules: { 'compact_0.72_white': { name: 'Трехточечный 0.72W БЕЛЫЙ', power: 0.72 }, 'compact_1.2_white': { name: 'Трехточечный 1.2W БЕЛЫЙ', power: 1.2 }, 'compact_0.72_warm': { name: 'Трехточечный 0.72W ТЕПЛЫЙ', power: 0.72 }, 'compact_0.72_red': { name: 'Трехточечный 0.72W КРАСНЫЙ', power: 0.72 }, 'compact_0.72_blue': { name: 'Трехточечный 0.72W СИНИЙ', power: 0.72 }, 'compact_0.72_green': { name: 'Трехточечный 0.72W ЗЕЛЕНЫЙ', power: 0.72 }, 'compact_0.72_yellow': { name: 'Трехточечный 0.72W ЖЕЛТЫЙ', power: 0.72 } } }, "PRO": { name: "PRO серия", modules: { 'pro_0.36': { name: 'Одноточечный 0.36W PRO', power: 0.36 }, 'pro_0.5': { name: 'Одноточечный 0.5W PRO', power: 0.5 }, 'pro_1.0': { name: 'Двухточечный 1W PRO', power: 1.0 }, 'pro_1.51': { name: 'Трехточечный 1.51W PRO', power: 1.51 }, 'pro_2.02': { name: 'Четырехточечный 2.02W PRO', power: 2.02 }, 'pro_3.0': { name: 'Шеститочечный 3W PRO', power: 3.0 } } } };
        this.SHEET_DATA = {
            'pvc': { name: 'ПВХ (PVC)', series: { 'lite': { name: 'Lite', thicknesses: ['4.5', '5', '8'] }, 'standart': { name: 'STANDART', thicknesses: ['3', '4.5', '5', '8', '10', '15', '20'] }, 'strong': { name: 'STRONG', thicknesses: ['3', '5'] }, 'solid': { name: 'SOLID', thicknesses: ['2', '3', '3 (черный)', '3 (красный)', '5', '8', '16'] }, 'hd': { name: 'HD', thicknesses: ['3', '5', '5 (зеленый)', '5 (красный)', '5 (желтый)', '5 (синий)', '5 (черный)', '8', '8 (черный)', '10'] } } },
            'plexiglass': { name: 'Оргстекло', thicknesses: ['2', '3', '4', '5', '6', '8', '10'] },
            'acrylic': { name: 'Акрил', thicknesses: ['3', '4', '5'] },
            'pet': { name: 'PET (ПЭТ)', thicknesses: ['0.5', '0.7', '1', '1.5', '2'] }
        };
        this.STANDARD_SHEET_AREA = 1.22 * 2.44;
        this.PSU_SIZES = [40, 60, 80, 100, 120, 150, 200, 250, 300, 350, 400];
        this.MAX_PSU_POWER = 400;
        this.translations = {
            ru: { nav_lights: 'Источники света LED', nav_materials: 'Листовые материалы', nav_controllers: 'Источники управления', project_params_title: 'Параметры вывески', sign_text_label: 'Текст вывески:', letter_height_label: 'Высота букв (мм):', letter_depth_label: 'Глубина букв (мм):', sign_length_label: 'Длина вывески (мм):', diode_series_label: 'Серия светодиодов:', diode_modules_label: 'Светодиодные модули:', summary_tab: 'Сводка', lighting_tab: 'Схемы букв', power_tab: 'Питание', summary_title: 'Итоговая сводка по проекту', lighting_title_new: 'Визуальные схемы расположения диодов', power_title: 'Расчет блока питания', calculate_btn: 'Рассчитать', reset_btn: 'Сброс', total_diodes: 'Общее кол-во модулей', pieces: 'шт.', total_power: 'Общая мощность', psu_recommendation: 'Рекомендация по БП', psu_config: 'Конфигурация', power_calc_title: 'Быстрый расчет БП', calculate_btn_power: 'Расчет БП', alert_fill_fields: 'Пожалуйста, заполните все параметры!', letter: "Буква", voltage_label: "Напряжение:", product_type_label: "Тип продукции:", product_module: "Диодные модули", product_strip: "Светодиодная лента", wattage_per_item_label_module: "Мощность на модуль (Вт):", wattage_per_item_label_strip: "Мощность на метр (Вт):", quantity_label_module: "Количество модулей (шт):", quantity_label_strip: "Длина ленты (м):", safety_margin_label: "Запас мощности:", base_power: "Базовая мощность", power_reserve: "Запас мощности", total_required_power: "Итоговая мощность", psu_final_reco: 'Рекомендация', sheet_calc_title: "Расчет листовых материалов", material_type_label: "Тип материала:", pvc_series_label: "Серия:", pvc_thickness_label: "Толщина:", calc_method_label: "Метод расчета:", calc_method_dims: "По размерам", calc_method_sqm: "По площади", width_label: "Ширина (мм):", height_label: "Высота (мм):", sqm_label: "Площадь (м²):", calculate_btn_sheet: "Рассчитать листы", required_sheets: "Требуемое кол-во листов", },
            en: { nav_lights: 'LED Light Sources', nav_materials: 'Sheet Materials', nav_controllers: 'Control Sources', project_params_title: 'Sign Parameters', sign_text_label: 'Sign Text:', letter_height_label: 'Letter Height (mm):', letter_depth_label: 'Letter Depth (mm):', sign_length_label: 'Sign Length (mm):', diode_series_label: 'Diode Series:', diode_modules_label: 'LED Modules:', summary_tab: 'Summary', lighting_tab: 'Letter Schemes', power_tab: 'Power', summary_title: 'Project Summary', lighting_title_new: 'Visual Diode Layout Schemes', power_title: 'Power Supply Calculation', calculate_btn: 'Calculate', reset_btn: 'Reset', total_diodes: 'Total Modules', pieces: 'pcs', total_power: 'Total Power', psu_recommendation: 'PSU Recommendation', psu_config: 'Configuration', power_calc_title: 'Quick PSU Calculator', calculate_btn_power: 'Calculate PSU', alert_fill_fields: 'Please fill all parameters!', letter: "Letter", voltage_label: "Voltage:", product_type_label: "Product Type:", product_module: "Diode modules", product_strip: "LED strip", wattage_per_item_label_module: "Power per module (W):", wattage_per_item_label_strip: "Power per meter (W):", quantity_label_module: "Number of modules (pcs):", quantity_label_strip: "Strip length (m):", safety_margin_label: "Power reserve:", base_power: "Base power", power_reserve: "Power reserve", total_required_power: "Total required power", psu_final_reco: 'Recommendation', sheet_calc_title: "Sheet Material Calculator", material_type_label: "Material Type:", pvc_series_label: "Series:", pvc_thickness_label: "Thickness:", calc_method_label: "Calculation Method:", calc_method_dims: "By Dimensions", calc_method_sqm: "By Area", width_label: "Width (mm):", height_label: "Height (mm):", sqm_label: "Area (m²):", calculate_btn_sheet: "Calculate Sheets", required_sheets: "Required sheets", }
        };
        this.currentLang = 'ru';
        this.projectData = {};
        this.init();
    }
    init() {
        this.addEventListeners();
        this.populateDiodeSeriesSelect();
        this.populateMaterialTypeSelect();
        this.updatePsuInputLabels();
        this.toggleSheetInputMethod('dims');
        this.setLanguage(localStorage.getItem('admartLang') || 'ru');
    }
    setLanguage(lang) {
        if (!this.translations[lang]) return;
        this.currentLang = lang;
        localStorage.setItem('admartLang', lang);
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            const translation = this.translations[this.currentLang][key];
            if (translation) el.textContent = translation;
        });
        document.querySelectorAll('.language-switcher button').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`lang-${lang}`).classList.add('active');
        // Re-populate all dynamic selects after language change
        this.populateDiodeSeriesSelect();
        this.populateMaterialTypeSelect();
        this.updatePsuInputLabels();
    }
    addEventListeners() {
        document.getElementById('calculate-btn').addEventListener('click', () => this.runCalculations());
        document.getElementById('reset-btn').addEventListener('click', () => this.reset());
        document.getElementById('diode-series').addEventListener('change', () => this.populateDiodeModuleSelect());
        document.getElementById('calculate-psu-btn').addEventListener('click', () => this.calculateQuickPSU());
        document.getElementById('reset-psu-btn').addEventListener('click', () => this.resetQuickPSU());
        document.getElementById('psu-product-type').addEventListener('change', () => this.updatePsuInputLabels());
        document.getElementById('calculate-sheet-btn').addEventListener('click', () => this.calculateSheets());
        document.getElementById('reset-sheet-btn').addEventListener('click', () => this.resetSheetCalculator());
        document.getElementById('sheet-material-type').addEventListener('change', () => this.onMaterialTypeChange());
        document.getElementById('sheet-series').addEventListener('change', () => this.populateSheetThicknessSelect());
        document.querySelectorAll('input[name="sheet-calc-method"]').forEach(radio => {
            radio.addEventListener('change', (e) => this.toggleSheetInputMethod(e.target.value));
        });
        document.querySelectorAll('.tab-button[data-tab]').forEach(btn => { btn.addEventListener('click', (e) => { document.querySelectorAll('.tab-button, .tab-content').forEach(el => el.classList.remove('active')); e.target.classList.add('active'); document.getElementById(e.target.dataset.tab).classList.add('active'); }); });
        document.querySelectorAll('.language-switcher button').forEach(btn => { btn.addEventListener('click', (e) => this.setLanguage(e.target.dataset.lang)); });
    }
    populateDiodeSeriesSelect() {
        const select = document.getElementById('diode-series');
        select.innerHTML = '';
        for (const key in this.DIODE_DATA) {
            const option = document.createElement('option');
            option.value = key; option.textContent = this.DIODE_DATA[key].name; select.appendChild(option);
        }
        this.populateDiodeModuleSelect();
    }
    populateDiodeModuleSelect() {
        const seriesKey = document.getElementById('diode-series').value;
        const select = document.getElementById('light-source');
        select.innerHTML = '';
        if (!seriesKey || !this.DIODE_DATA[seriesKey]) return;
        const series = this.DIODE_DATA[seriesKey];
        for (const key in series.modules) {
            const option = document.createElement('option');
            option.value = key; option.textContent = series.modules[key].name; select.appendChild(option);
        }
    }
    populateMaterialTypeSelect() {
        const select = document.getElementById('sheet-material-type');
        select.innerHTML = '';
        for (const key in this.SHEET_DATA) {
            const option = document.createElement('option');
            option.value = key; option.textContent = this.SHEET_DATA[key].name; select.appendChild(option);
        }
        this.onMaterialTypeChange();
    }
    onMaterialTypeChange() {
        const materialKey = document.getElementById('sheet-material-type').value;
        const material = this.SHEET_DATA[materialKey];
        const seriesGroup = document.getElementById('sheet-series-group');
        if (material && material.series) {
            seriesGroup.style.display = 'block';
            this.populateSheetSeriesSelect();
        } else {
            seriesGroup.style.display = 'none';
            this.populateSheetThicknessSelect();
        }
    }
    populateSheetSeriesSelect() {
        const materialKey = document.getElementById('sheet-material-type').value;
        const material = this.SHEET_DATA[materialKey];
        const select = document.getElementById('sheet-series');
        select.innerHTML = '';
        if (!material || !material.series) return;
        for (const key in material.series) {
            const option = document.createElement('option');
            option.value = key; option.textContent = material.series[key].name; select.appendChild(option);
        }
        this.populateSheetThicknessSelect();
    }
    populateSheetThicknessSelect() {
        const materialKey = document.getElementById('sheet-material-type').value;
        const material = this.SHEET_DATA[materialKey];
        const select = document.getElementById('sheet-thickness');
        select.innerHTML = '';
        if (!material) return;
        let thicknesses = [];
        if (material.series) {
            const seriesKey = document.getElementById('sheet-series').value;
            if (material.series[seriesKey]) {
                thicknesses = material.series[seriesKey].thicknesses;
            }
        } else {
            thicknesses = material.thicknesses;
        }
        thicknesses.forEach(thickness => {
            const option = document.createElement('option');
            option.value = thickness; option.textContent = `${thickness} мм`; select.appendChild(option);
        });
    }
    toggleSheetInputMethod(method) { document.getElementById('sheet-dims-inputs').style.display = method === 'dims' ? 'block' : 'none'; document.getElementById('sheet-sqm-input').style.display = method === 'sqm' ? 'block' : 'none'; }
    resetSheetCalculator() { document.getElementById('sheet-width').value = ''; document.getElementById('sheet-height').value = ''; document.getElementById('sheet-sqm').value = ''; document.getElementById('sheet-calc-result').style.display = 'none'; }
    calculateSheets() {
        const method = document.querySelector('input[name="sheet-calc-method"]:checked').value;
        let requiredSqm = 0;
        if (method === 'dims') {
            const width = parseFloat(document.getElementById('sheet-width').value);
            const height = parseFloat(document.getElementById('sheet-height').value);
            if (!width || !height || width <= 0 || height <= 0) { alert(this.translations[this.currentLang].alert_fill_fields); return; }
            requiredSqm = (width * height) / 1000000;
        } else {
            requiredSqm = parseFloat(document.getElementById('sheet-sqm').value);
            if (!requiredSqm || requiredSqm <= 0) { alert(this.translations[this.currentLang].alert_fill_fields); return; }
        }
        const numSheets = Math.ceil(requiredSqm / this.STANDARD_SHEET_AREA);
        const resultEl = document.getElementById('sheet-calc-result');
        const t = this.translations[this.currentLang];
        resultEl.innerHTML = `${t.required_sheets}: <strong>${numSheets} ${t.pieces}</strong>`;
        resultEl.style.display = 'block';
    }
    updatePsuInputLabels() { const productType = document.getElementById('psu-product-type').value; const t = this.translations[this.currentLang]; const wattageLabel = document.getElementById('psu-wattage-label'); const quantityLabel = document.getElementById('psu-quantity-label'); if (productType === 'module') { wattageLabel.textContent = t.wattage_per_item_label_module; quantityLabel.textContent = t.quantity_label_module; } else { wattageLabel.textContent = t.wattage_per_item_label_strip; quantityLabel.textContent = t.quantity_label_strip; } }
    resetQuickPSU() { document.getElementById('psu-wattage-per-unit').value = ''; document.getElementById('psu-quantity').value = ''; document.getElementById('power-calc-result').style.display = 'none'; }
    calculateQuickPSU() { const wattagePerUnit = parseFloat(document.getElementById('psu-wattage-per-unit').value); const quantity = parseFloat(document.getElementById('psu-quantity').value); const margin = parseFloat(document.getElementById('psu-safety-margin').value); const voltage = document.getElementById('psu-voltage').value; const resultEl = document.getElementById('power-calc-result'); if (!wattagePerUnit || !quantity || wattagePerUnit <= 0 || quantity <= 0) { alert(this.translations[this.currentLang].alert_fill_fields); resultEl.style.display = 'none'; return; } const basePower = wattagePerUnit * quantity; const powerReserveValue = basePower * margin; const requiredPower = basePower + powerReserveValue; const recommendation = this.getPSURecommendation(requiredPower, voltage); const t = this.translations[this.currentLang]; resultEl.innerHTML = `${t.base_power}: ${basePower.toFixed(1)} W\n${t.power_reserve} (${(margin * 100).toFixed(0)}%): ${powerReserveValue.toFixed(1)} W\n-------------------------\n<strong>${t.total_required_power}: ${requiredPower.toFixed(1)} W</strong>\n<hr>\n<strong>${t.psu_final_reco}: ${recommendation}</strong>`; resultEl.style.display = 'block'; }
    getPSURecommendation(power, voltage) { if (power <= this.MAX_PSU_POWER) { const suitablePSU = this.PSU_SIZES.find(size => size >= power) || this.MAX_PSU_POWER; return `1 x ${suitablePSU}W / ${voltage}V`; } else { const numBlocks = Math.ceil(power / this.MAX_PSU_POWER); const powerPerBlock = Math.ceil(power / numBlocks); const suitablePSU = this.PSU_SIZES.find(size => size >= powerPerBlock) || this.MAX_PSU_POWER; return `${numBlocks} x ${suitablePSU}W / ${voltage}V`; } }
    runCalculations() { const text = document.getElementById('project-text').value.trim().toUpperCase(); const height = parseFloat(document.getElementById('project-height').value); const length = parseFloat(document.getElementById('project-length').value); const sourceKey = document.getElementById('light-source').value; const seriesKey = document.getElementById('diode-series').value; if (!text || !height || !length || !sourceKey || !seriesKey) { alert(this.translations[this.currentLang].alert_fill_fields); return; } this.projectData = { text, height, length, source: this.DIODE_DATA[seriesKey].modules[sourceKey] }; const loader = document.getElementById('visual-loader'); loader.style.display = 'block'; document.getElementById('visual-schemes').innerHTML = ''; document.getElementById('results-panel').style.display = 'grid'; setTimeout(() => { this.calculateLighting(); this.calculatePower(); this.renderSummary(); loader.style.display = 'none'; }, 100); }
    reset() { document.getElementById('project-text').value = ''; document.getElementById('project-height').value = '300'; document.getElementById('project-length').value = '1500'; document.getElementById('project-depth').value = '80'; document.getElementById('results-panel').style.display = 'none'; document.getElementById('visual-schemes').innerHTML = ''; this.projectData = {}; }
    calculateLighting() { const { text, height, length, source } = this.projectData; const schemesContainer = document.getElementById('visual-schemes'); let totalDiodes = 0; let letterResults = []; const chars = text.replace(/\s/g, '').split(''); const tempCtx = document.createElement('canvas').getContext('2d'); tempCtx.font = `bold ${height}px Arial`; const totalNaturalWidth = chars.reduce((sum, char) => sum + tempCtx.measureText(char).width, 0); const scaleFactor = totalNaturalWidth > 0 ? length / totalNaturalWidth : 0; chars.forEach(char => { const naturalWidth = tempCtx.measureText(char).width; const scaledWidth = naturalWidth * scaleFactor; const { canvas, diodeCount } = this.createLetterScheme(char, height, scaledWidth); totalDiodes += diodeCount; letterResults.push({ char, canvas, diodeCount }); }); this.projectData.lighting = { total_diodes: totalDiodes, total_power: totalDiodes * source.power }; schemesContainer.innerHTML = ''; const t = this.translations[this.currentLang]; letterResults.forEach(res => { const wrapper = document.createElement('div'); wrapper.className = 'scheme-item'; const label = document.createElement('div'); label.textContent = `${t.letter} "${res.char}" (${res.diodeCount} ${t.pieces})`; wrapper.appendChild(res.canvas); wrapper.appendChild(label); schemesContainer.appendChild(wrapper); }); }
    createLetterScheme(char, height, width) { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d', { willReadFrequently: true }); canvas.width = Math.max(1, Math.ceil(width)); canvas.height = Math.max(1, Math.ceil(height)); const font = `bold ${height}px Arial`; ctx.font = font; ctx.textBaseline = 'middle'; ctx.textAlign = 'center'; const naturalWidth = ctx.measureText(char).width; const effectiveScale = naturalWidth > 0 ? width / naturalWidth : 0; ctx.save(); ctx.translate(width / 2, height / 2); ctx.scale(effectiveScale, 1); ctx.fillText(char, 0, 0); ctx.restore(); const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = '#666'; ctx.save(); ctx.translate(width / 2, height / 2); ctx.scale(effectiveScale, 1); ctx.fillText(char, 0, 0); ctx.restore(); ctx.fillStyle = 'red'; const diodeRadius = Math.max(2, height / 100); const step = 150; let diodeCount = 0; for (let y = step / 2; y < height; y += step) { for (let x = step / 2; x < width; x += step) { const pxIndex = (Math.floor(y) * canvas.width + Math.floor(x)) * 4; if (imageData.length > pxIndex + 3 && imageData[pxIndex + 3] > 128) { ctx.beginPath(); ctx.arc(x, y, diodeRadius, 0, 2 * Math.PI); ctx.fill(); diodeCount++; } } } if (diodeCount === 0) { const centerX = width / 2; const centerY = height / 2; const pxIndex = (Math.floor(centerY) * canvas.width + Math.floor(centerX)) * 4; if (imageData.length > pxIndex + 3 && imageData[pxIndex + 3] > 128) { ctx.beginPath(); ctx.arc(centerX, centerY, diodeRadius, 0, 2 * Math.PI); ctx.fill(); diodeCount = 1; } } return { canvas, diodeCount }; }
    calculatePower() { const { total_power } = this.projectData.lighting; const requiredPower = total_power * 1.3; const recommendation = this.getPSURecommendation(requiredPower, '12'); this.projectData.power = { recommendation }; const t = this.translations[this.currentLang]; document.getElementById('power-result').innerHTML = `<div class="result-item"><div class="label">${t.total_power}</div><div class="value">${total_power.toFixed(1)} W</div></div><div class="result-item"><div class="label">${t.psu_recommendation} (+30%)</div><div class="value">${requiredPower.toFixed(1)} W</div></div><div class="result-item"><div class="label">${t.psu_config}</div><div class="value">${recommendation}</div></div>`; }
    renderSummary() { const { lighting, power, text } = this.projectData; const summaryEl = document.getElementById('summary-list'); const t = this.translations[this.currentLang]; summaryEl.innerHTML = `<li><span class="label">${t.sign_text_label}</span><span class="value">"${text}"</span></li><li><span class="label">${t.total_diodes}</span><span class="value">${lighting.total_diodes} ${t.pieces}</span></li><li><span class="label">${t.total_power}</span><span class="value">${lighting.total_power.toFixed(1)} W</span></li><li><span class="label">${t.psu_recommendation}</span><span class="value">${power.recommendation}</span></li>`; }
}
document.addEventListener('DOMContentLoaded', () => { new AdmartVisualHelper(); });
</script>

</body>
</html>
